<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Racing Game</title>
<style>
  body { margin: 0; background: #222; display: flex; flex-direction: column; align-items: center; font-family: Arial, sans-serif; color: white; }
  canvas { background: #555; display: block; border: 5px solid #fff; margin-top: 20px; }
  #menu { margin-top: 50px; }
  button { margin: 5px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
</style>
</head>
<body>
<h1>Racing Game</h1>
<div id="menu">
  <p>Select a track:</p>
  <button onclick="startGame(0)">Track 1</button>
  <button onclick="startGame(1)">Track 2</button>
  <button onclick="startGame(2)">Track 3</button>
  <button onclick="startGame(3)">Track 4</button>
  <button onclick="startGame(4)">Track 5</button>
</div>
<canvas id="gameCanvas" width="400" height="600"></canvas>
<p id="timer">Time: 0s</p>
<p id="highscore">Highscore: 0s</p>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let tracks = [
  {color: '#333', laneColor: 'white'}, 
  {color: '#444', laneColor: 'yellow'}, 
  {color: '#555', laneColor: 'cyan'}, 
  {color: '#666', laneColor: 'pink'}, 
  {color: '#777', laneColor: 'orange'}
];

const player = {x: 185, y: 520, width: 30, height: 50, color: 'red', speed: 5};
let obstacles = [];
let obstacleSpeed = 3;
let score = 0;
let gameOver = false;
let currentTrack = 0;
let timer = 0;
let timerInterval;

function drawRoad() {
  const track = tracks[currentTrack];
  ctx.fillStyle = track.color;
  ctx.fillRect(100, 0, 200, canvas.height);
  ctx.strokeStyle = track.laneColor;
  ctx.lineWidth = 4;
  ctx.setLineDash([20, 20]);
  for (let i = 0; i < 5; i++) {
    ctx.beginPath();
    ctx.moveTo(200, i*150);
    ctx.lineTo(200, i*150+100);
    ctx.stroke();
  }
}

function drawPlayer() {
  ctx.fillStyle = player.color;
  ctx.fillRect(player.x, player.y, player.width, player.height);
}

function drawObstacles() {
  ctx.fillStyle = 'blue';
  obstacles.forEach(obs => ctx.fillRect(obs.x, obs.y, obs.width, obs.height));
}

function moveObstacles() {
  obstacles.forEach(obs => obs.y += obstacleSpeed);
  obstacles = obstacles.filter(obs => obs.y < canvas.height);
}

function generateObstacles() {
  if (Math.random() < 0.02) {
    let obsWidth = Math.random() * 50 + 30;
    let obsX = 100 + Math.random() * (200 - obsWidth);
    obstacles.push({x: obsX, y: -50, width: obsWidth, height: 20});
  }
}

function checkCollision() {
  for (let obs of obstacles) {
    if (
      player.x < obs.x + obs.width &&
      player.x + player.width > obs.x &&
      player.y < obs.y + obs.height &&
      player.y + player.height > obs.y
    ) gameOver = true;
  }
}

function drawScore() {
  ctx.fillStyle = 'white';
  ctx.font = '20px Arial';
  ctx.fillText(`Score: ${score}`, 10, 30);
}

function drawTimer() {
  document.getElementById('timer').textContent = `Time: ${timer}s`;
}

function updateHighscore() {
  let hs = parseInt(localStorage.getItem('highscore')) || 0;
  if (timer > hs) {
    localStorage.setItem('highscore', timer);
    hs = timer;
  }
  document.getElementById('highscore').textContent = `Highscore: ${hs}s`;
}

function gameLoop() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawRoad();
  drawPlayer();
  drawObstacles();
  drawScore();
  if (!gameOver) {
    moveObstacles();
    generateObstacles();
    checkCollision();
    score++;
    requestAnimationFrame(gameLoop);
  } else {
    clearInterval(timerInterval);
    ctx.fillStyle = 'white';
    ctx.font = '40px Arial';
    ctx.fillText('GAME OVER', canvas.width/2 - 120, canvas.height/2);
    updateHighscore();
    document.getElementById('menu').style.display = 'block';
  }
}

function startGame(trackIndex) {
  currentTrack = trackIndex;
  obstacles = [];
  score = 0;
  timer = 0;
  gameOver = false;
  player.x = 185;
  document.getElementById('menu').style.display = 'none';
  timerInterval = setInterval(() => { timer++; drawTimer(); }, 1000);
  gameLoop();
}

document.addEventListener('keydown', e => {
  if (e.key === 'ArrowLeft' && player.x > 100) player.x -= player.speed;
  if (e.key === 'ArrowRight' && player.x + player.width < 300) player.x += player.speed;
});

// Load highscore on page load
updateHighscore();
</script>
</body>
</html>
